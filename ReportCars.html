<div class="row g-3 mt-3">
  <div class="col-12">
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-header bg-white rounded-top-4 border-bottom py-3">
        <div class="row align-items-center g-2">
          <div class="col-12 col-md-4">
            <h6 class="mb-0">üöó ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏£‡∏ñ‡πÄ‡∏ä‡πà‡∏≤</h6>
          </div>
          <div class="col-12 col-md-8 d-flex flex-wrap justify-content-md-end gap-2">
            <input type="date" id="searreportCars2" class="form-control" oninput="filterreportCars()" style="max-width: 100%; min-width: 160px;">
            <input type="date" id="searreportCars3" class="form-control" oninput="filterreportCars()" style="max-width: 100%; min-width: 160px;">
            <input type="search" id="searreportCars1" class="form-control" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..." oninput="filterreportCars()" style="max-width: 100%; min-width: 180px;">
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm table-bordered align-middle">
            <thead class="table-light text-center">
              <tr>
                <th scope="col">#</th>
                <th scope="col">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏≠‡πÉ‡∏ä‡πâ</th>
                <th scope="col">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏ñ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤</th>
                <th scope="col">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏ñ</th>
                <th scope="col">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th scope="col">‡∏™‡πà‡∏á‡∏£‡∏ñ</th>
                <th scope="col">‡πÉ‡∏ö‡πÉ‡∏ä‡πâ‡∏£‡∏ñ</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody id="tableReportCars" class="text-center"></tbody>
          </table>
        </div>
        <div class="row mt-3">
          <div class="col-12 col-md-6 mb-2 mb-md-0 d-flex align-items-center" id="paginationRPCarsInfo"></div>
          <div class="col-12 col-md-6 d-flex justify-content-md-end align-items-center">
            <div id="paginationRPCars" class="pagination mb-0"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let reportCars = [];
let findreportCars = [];
let currentreportCars = 1;
let itemsPerreportCars = 10;

const insertReportCars = () => {
  google.script.run.withSuccessHandler((data) => {
    const userRole1 = localStorage.getItem('fullname') || '';
    const userRole2 = localStorage.getItem('level') || '';

    reportCars = data.filter(row => {
      if (userRole2 === 'SuperAdmin' || userRole2 === 'Admin') return true;
      return row[4] === userRole1 || row[14] === userRole1; 
    });

    findreportCars = reportCars;
    renderreportCars(reportCars);
    renderPagereportCars(reportCars.length);
    countsReportCars(reportCars);
    filterreportCars();
  }).getDataCar();
}

const renderreportCars = (res) => {
  const table = document.getElementById('tableReportCars');
  table.innerHTML = '';

  res.sort((a, b) => parseDate(b[15]) - parseDate(a[15]));

  const userRole1 = localStorage.getItem('fullname') || '';
  const userRole2 = localStorage.getItem('level') || '';

  const startIndex = (currentreportCars - 1) * itemsPerreportCars;
  const endIndex = startIndex + itemsPerreportCars;
  const report = res.slice(startIndex, endIndex);

  const startRow = startIndex + 1;
  const endRow = startIndex + report.length;
  const totalRows = res.length;

  document.getElementById('paginationRPCarsInfo').innerText = `‡πÅ‡∏™‡∏î‡∏á ${startRow} ‡∏ñ‡∏∂‡∏á ${endRow} ‡∏à‡∏≤‡∏Å ${totalRows} ‡πÅ‡∏ñ‡∏ß`;

  if (report.length === 0) {
    const row = table.insertRow();
    row.innerHTML = `<td colspan='9' class='fw-bold text-danger text-center p-4'><i class='fa-solid fa-circle-info text-danger'></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•! üòì</td>`;
    return;
  }

  report.forEach((rowIndex, index) => {
    let status = rowIndex[1];
    let pdfLink = rowIndex[27];
    let pdfButton;
    let actionButton;

    let mileGo = parseFloat(rowIndex[20]) || 0;
    let mileReturn = parseFloat(rowIndex[21]) || 0;
    let totalDistance = mileReturn - mileGo > 0 ? (mileReturn - mileGo).toFixed(2) + ' ‡∏Å‡∏°.' : 'N/A';

    if (userRole2 === 'SuperAdmin' || userRole2 === 'Admin' || userRole1 === rowIndex[4]) {
      if (pdfLink) {
        pdfButton = `<a href="${pdfLink}" target="_blank" class="btn btn-sm me-2 set-button"><i class="fa-solid fa-download"></i> ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</a>`;
      } else {
        pdfButton = `<button class="btn btn-sm me-2 del-button">‚ùå ‡πÑ‡∏ü‡∏•‡πå</button>`;
      }
    } else {
      pdfButton = `<button class="btn btn-sm me-2 del-button" onclick="createToast('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ', 3)">‚ùå ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå</button>`;
    }

    if (status === '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥') {
      if (!rowIndex[20]) {
        actionButton = `<button class="btn btn-sm edit-button" onclick="openSendCarModal('start', '${rowIndex[0]}')">üöó ‡∏≠‡∏≠‡∏Å‡∏£‡∏ñ</button>`;
      } else if (!rowIndex[21]) {
        actionButton = `<button class="btn btn-sm del-button" onclick="openSendCarModal('return', '${rowIndex[0]}')">üöò ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ</button>`;
      } else {
        actionButton = `<button class="btn btn-sm upload-button" onclick="createToast('‚úÖ ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 2)">‚úÖ ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</button>`;
      }
    } else {
      actionButton = `<button class="btn btn-sm del-button" onclick="createToast('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 0)">‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>`;
    }

    switch (status) {
      case "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö":
        status = `<span style="color: var(--box1);font-size: 14px;">‚åõ ${rowIndex[1]}</span>`;
        break;
      case "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥":
        status = `<span style="color: var(--box2);font-size: 14px;">‚úÖ ${rowIndex[1]}</span>`;
        break;
      case "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å":
        status = `<span style="color: var(--box4);font-size: 14px;">‚ùå ${rowIndex[1]}</span>`;
        break;
      default:
        status = `<span style="color: var(--box4);font-size: 14px;">‚ùå ${rowIndex[1]}</span>`;
    }

    let user = dataUsers.find(user => user[0] === rowIndex[3]);
    let userImage = user ? user[7] : 'https://e1.pngegg.com/pngimages/98/854/png-clipart-voiture-location-de-voitures-location-logo-tour-operateur-tourisme-vacances-client.png';

    let car = dataShowCars.find(car => car[0] === rowIndex[11]);
    let carImage = car ? car[8] : 'https://e1.pngegg.com/pngimages/98/854/png-clipart-voiture-location-de-voitures-location-logo-tour-operateur-tourisme-vacances-client.png';

    var row = table.insertRow();
    row.innerHTML = `
      <td class="text-center"><span style="font-size: 14px;">${startIndex + index + 1}</span></td>
      <td>
        <div style="display: flex; align-items: center;">
          <img src="${userImage}" alt="ImageUsers" width="30px" style="margin-right: 10px;">
          <div style="font-size: 14px;">
            <span>üôã‡∏ä‡∏∑‡πà‡∏≠: ${rowIndex[4]}</span><br>
            <span>‡∏ù‡πà‡∏≤‡∏¢: ${rowIndex[6]}</span><br>
            <span>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô: ${rowIndex[5]}</span><br>
            <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á: ${rowIndex[2]}</span>
          </div>
        </div>
      </td>
      <td>
        <div style="display: flex; align-items: center;">
          <img src="${carImage}" alt="ImageUsers" width="50px" style="margin-right: 10px;">
          <div style="font-size: 14px;">
            <span>${status}</span><br>
            <span>KeyCar: ${rowIndex[11]}</span><br>
            <span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${rowIndex[12]}</span><br>
            <span>‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ: ${rowIndex[13]}</span>
          </div>
        </div>
      </td>
      <td>
        <span style="font-size: 14px;">üë®‚Äçüíº‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•: ${rowIndex[10]}</span><br>
        <span style="font-size: 14px;">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô: ${rowIndex[8]}</span><br>
        <span style="font-size: 14px;">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏Ç‡∏±‡∏ö‡∏Ç‡∏µ‡πà: ${rowIndex[9]}</span><br>
        <span style="font-size: 14px;">üõ£Ô∏è‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á ${totalDistance}</span>
      </td>
      <td>
        <span style="font-size: 14px;">üóìÔ∏è‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°: ${rowIndex[15]}</span><br>
        <span style="font-size: 14px;">üóìÔ∏è‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î: ${rowIndex[16]}</span><br>
        <span style="font-size: 14px;">üë®‚Äçüíº‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${rowIndex[19]} ‡∏Ñ‡∏ô</span>
      <td class="text-center">${actionButton}</td>
      <td class="text-center">${pdfButton}</td>
      <td class="text-center"><button class="btn btn-sm upload-button" onclick="uploadFileCars('${rowIndex[0]}');"> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î</button></td>
    `;
  });
}

const renderPagereportCars = (totalItems) => {
  const totalPages = Math.ceil(totalItems / itemsPerreportCars);
  const paginationContainer = document.getElementById('paginationRPCars');
  paginationContainer.innerHTML = '';
  if (totalPages > 1) {
    const createPageButton = (text, page, isDisabled = false, isActive = false) => {
      const li = document.createElement('li');
      li.className = `page-item ${isDisabled ? 'disabled' : ''} ${isActive ? 'active' : ''}`;
      const button = document.createElement('button');
      button.className = 'page-link';
      button.innerText = text;
      button.onclick = () => {
        if (!isDisabled) {
          currentreportCars = page;
          renderreportCars(reportCars);
          renderPagereportCars(totalItems);
        }
      };
      li.appendChild(button);
      return li;
    };
    paginationContainer.appendChild(createPageButton('‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö', currentreportCars - 1, currentreportCars === 1));

    if (currentreportCars > 2) {
      paginationContainer.appendChild(createPageButton(1, 1, false, currentreportCars === 1));
      if (currentreportCars > 3) {
        const ellipsis = document.createElement('li');
        ellipsis.className = 'page-item disabled';
        ellipsis.innerHTML = '<span class="page-link">...</span>';
        paginationContainer.appendChild(ellipsis);
      }
    }
    paginationContainer.appendChild(createPageButton(currentreportCars, currentreportCars, false, true));

    if (currentreportCars < totalPages - 1) {
      if (currentreportCars < totalPages - 2) {
        const ellipsis = document.createElement('li');
        ellipsis.className = 'page-item disabled';
        ellipsis.innerHTML = '<span class="page-link">...</span>';
        paginationContainer.appendChild(ellipsis);
      }
      paginationContainer.appendChild(createPageButton(totalPages, totalPages, false, currentreportCars === totalPages));
    }
    paginationContainer.appendChild(createPageButton('‡∏ñ‡∏±‡∏î‡πÑ‡∏õ', currentreportCars + 1, currentreportCars === totalPages));
  }
}

const filterreportCars = () => {
  const query = document.getElementById('searreportCars1').value.toLowerCase();
  const startDate = document.getElementById('searreportCars2').value;
  const endDate = document.getElementById('searreportCars3').value;
  if (!startDate || !endDate) return;
  const userRole1 = localStorage.getItem('fullname') || '';
  const userRole2 = localStorage.getItem('level') || '';

  findreportCars = reportCars.filter(row => {
    const rowStartDate = row[15];
    const rowEndDate = row[16];

    const isWithinDateRange = (!startDate || rowStartDate >= startDate) && 
                              (!endDate || rowEndDate <= endDate);
    const matchesQuery = row.some(column => column.toLowerCase().includes(query));

    if (userRole2 !== 'SuperAdmin' && userRole2 !== 'Admin') {
      if (row[4] !== userRole1 && row[14] !== userRole1) return false;
    }

    return isWithinDateRange && matchesQuery;
  });

  currentreportCars = 1;
  renderreportCars(findreportCars);
  renderPagereportCars(findreportCars.length);
  countsReportCars(findreportCars);
}

const countsReportCars = (data) => {
  const statusCounts = data.reduce((acc, row) => {
    const status = row[1];
    if (!acc[status]) {
      acc[status] = 0;
    }
    acc[status]++;
    return acc;
  }, {});

  const totalCount = data.length;

  const summaryContainer = document.getElementById('carsSummary');
  summaryContainer.innerHTML = `
    <p style="color: var(--box1);font-size: 14px;">‚åõ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: ${statusCounts['‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'] || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å: ${statusCounts['‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'] || 0} ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ${statusCounts['‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'] || 0} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ üìä ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
  `;
}

let currentAction = '';
let selectedCarID = '';

const openSendCarModal = (action, carID) => {
  const userRole = localStorage.getItem('level') || '';
  if (!['SuperAdmin', 'Admin', 'Driver'].includes(userRole)) {
    createToast("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ", 3);
    return;
  }
  currentAction = action;
  selectedCarID = carID;
  document.getElementById('startMileSection').style.display = 'none';
  document.getElementById('returnMileSection').style.display = 'none';
  document.getElementById('fuelSection').style.display = 'none';
  if (action === 'start') {
    document.getElementById('startMileSection').style.display = 'block';
  } else if (action === 'return') {
    document.getElementById('returnMileSection').style.display = 'block';
    document.getElementById('fuelSection').style.display = 'block';
  }
  $('#sendCarModal').modal('show');
};

const submitSendCars = () => {
  const startMile = document.getElementById('sendCarstartMile').value;
  const returnMile = document.getElementById('sendCarreturnMile').value;
  const fuelAmount = document.getElementById('sendCarfuelAmount').value;
  if (currentAction === 'start' && startMile) {
    $.LoadingOverlay("show", { image: "", fontawesome: "fa fa-spinner fa-spin" });
    google.script.run.withSuccessHandler(() => {
      $.LoadingOverlay("hide");
      insertReportCars();
      closeSendCars();
      createToast("‚úÖ ‡∏≠‡∏≠‡∏Å‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", 1);
    }).updateSendCarData(selectedCarID, startMile, null, null);
  }
  else if (currentAction === 'return' && returnMile && fuelAmount) {
    $.LoadingOverlay("show", { image: "", fontawesome: "fa fa-spinner fa-spin" });
    google.script.run.withSuccessHandler(() => {
      $.LoadingOverlay("hide");
      insertReportCars();
      closeSendCars();
      createToast("‚úÖ ‡∏Ñ‡∏∑‡∏ô‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢", 1);
    }).updateSendCarData(selectedCarID, null, returnMile, fuelAmount);
  }
  $('#sendCarModal').modal('hide');
};

const closeSendCars = () => {
  document.getElementById('sendCarstartMile').value = '';
  document.getElementById('sendCarreturnMile').value = '';
  document.getElementById('sendCarfuelAmount').value = '';
  createToast("üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß", 0);
}

const uploadFileCars = (codeID) => {
  const userRole = localStorage.getItem('level') || '';
  if (!['SuperAdmin', 'Admin', 'Driver'].includes(userRole)) {
    createToast("‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ", 3);
    return;
  }
  const fileInput = document.createElement('input');
  fileInput.type = 'file';
  fileInput.accept = '.pdf';
  fileInput.onchange = (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        const base64File = e.target.result.split(',')[1];
        const obj = {
          codeID: codeID,
          repairFile: base64File,
          fileName: file.name,
        };
        $.LoadingOverlay("show", { image: "", fontawesome: "fa fa-spinner fa-spin" });
        google.script.run.withSuccessHandler(() => {
          $.LoadingOverlay("hide");
          insertReportCars();
          createToast("‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", 1);
        }).adduploadFileCars(obj);
      };
      reader.readAsDataURL(file);
    }
  };
  fileInput.click(); 
};

const insertChartCars = () => {
  let monthCounts = new Map();
  const monthNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå", "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°", "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô", "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°", "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô", "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°", "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°", "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô", "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°", "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô", "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];
  const colors = ['#3c8cf3', '#05be8a', '#745af2', '#ef5350'];
  google.script.run.withSuccessHandler((data) => {
    data.forEach((item) => {
      if (item[15]) {
        const date = new Date(item[15]);
        const month = date.getMonth();
        const monthName = monthNames[month];
        if (monthCounts.has(monthName)) {
          monthCounts.set(monthName, monthCounts.get(monthName) + 1);
        } else {
          monthCounts.set(monthName, 1);
        }
      }
    });
    let seriesData = monthNames.map(month => monthCounts.get(month) || 0);
    var options = {
      series: [{
        name: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô',
        data: seriesData
      }],
      chart: {
        height: 350,
        type: 'area'
      },
      colors: colors,
      dataLabels: {
        enabled: false
      },
      stroke: {
        curve: 'smooth'
      },
      xaxis: {
        type: 'text',
        categories: monthNames,
        labels: {
          style: {
            fontSize: '12px',
            fontFamily: 'Prompt, sans-serif'
          }
        }
      },
      tooltip: {
        x: {
          format: 'dd/MM/yy HH:mm'
        }
      },
      fill: {
        colors: colors,
        type: 'gradient',
        gradient: {
          shadeIntensity: 1,
          opacityFrom: 0.7,
          opacityTo: 0.9,
          stops: [0, 90, 100]
        }
      }
    };
    const chart = new ApexCharts(document.querySelector("#chartCars"), options);
    chart.render();
  }).getDataCar();
}
</script>
